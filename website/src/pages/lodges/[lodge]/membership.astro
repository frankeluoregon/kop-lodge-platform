---
import Base from "../../../layouts/Base.astro";
import { getLodgeBySlug, getConfig, getPage } from "../../../lib/db";
import { renderMarkdown } from "../../../lib/markdown";

const lodgeSlug = Astro.params.lodge!;
const db = Astro.locals.runtime.env.DB;

const lodge = await getLodgeBySlug(db, lodgeSlug);
if (!lodge) return Astro.redirect("/", 302);

const config = await getConfig(db, lodge.id);
if (config.show_membership !== "1") return Astro.redirect(`/lodges/${lodgeSlug}`, 302);

const page = await getPage(db, lodge.id, "membership");
---

<Base config={config} lodgeSlug={lodgeSlug} title="Membership" description={page?.meta_description ?? undefined}>
  <div class="hero">
    <h1>Become a Knight</h1>
    <p>Join {config.lodge_name} &mdash; Knights of Pythias</p>
  </div>
  <main>
    {page
      ? <article class="prose" set:html={renderMarkdown(page.content)} />
      : <p style="color:#666">Membership information coming soon.</p>
    }
  </main>
</Base>
