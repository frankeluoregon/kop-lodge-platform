---
import Base from "../../../layouts/Base.astro";
import { getLodgeBySlug, getConfig, getOfficers } from "../../../lib/db";

const lodgeSlug = Astro.params.lodge!;
const db = Astro.locals.runtime.env.DB;

const lodge = await getLodgeBySlug(db, lodgeSlug);
if (!lodge) return Astro.redirect("/", 302);

const config   = await getConfig(db, lodge.id);
const officers = await getOfficers(db, lodge.id);
---

<Base config={config} lodgeSlug={lodgeSlug} title="Officers">
  <div class="hero">
    <h1>Officers</h1>
    <p>{config.lodge_name}</p>
  </div>
  <main>
    {officers.length === 0
      ? <p style="color:#666">Officer information coming soon.</p>
      : (
        <div class="card-grid">
          {officers.map((o) => (
            <div class="card">
              <h3>{o.title}</h3>
              <p>{o.name}</p>
              {o.email && <p class="meta"><a href={`mailto:${o.email}`}>{o.email}</a></p>}
            </div>
          ))}
        </div>
      )
    }
  </main>
</Base>
