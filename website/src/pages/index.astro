---
import { getAllLodges } from "../lib/db";

const db = Astro.locals.runtime.env.DB;
const lodges = await getAllLodges(db);

const primary   = "#252e67";
const accent    = "#f5a71c";
const secondary = "#a91e23";
const neutral   = "#4a5072";
const contentBg = "#ded3c3";
---

<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oregon Knights of Pythias – Lodge Directory</title>
  <meta name="description" content="Oregon Knights of Pythias — Lodge Directory. Friendship, Charity, Benevolence." />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <style define:vars={{ primary, accent, secondary, neutral, contentBg }}>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --primary: var(--primary); --accent: var(--accent); --neutral: var(--neutral);
      --text: #1a1a2e; --bg: #f7f8fc; --card-bg: #fff;
      --border: #dde0eb; --radius: 6px; --shadow: 0 2px 8px rgba(0,0,0,.08);
      --max-w: 1100px; --font: 'Trebuchet MS', Trebuchet, 'Gill Sans MT', Arial, sans-serif;
    }
    body { font-family: var(--font); background: var(--primary); color: var(--text); line-height: 1.7; }
    a { color: var(--primary); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .tricolor { display: flex; height: 5px; }
    .tricolor span { flex: 1; }

    header { background: var(--neutral); padding: 0 1.5rem; }
    .header-inner {
      max-width: var(--max-w); margin: 0 auto;
      display: flex; align-items: center; justify-content: space-between; gap: 1rem; padding: 1rem 0;
    }
    .brand-name { font-size: 1.4rem; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: .04em; }
    .brand-sub  { font-size: .78rem; color: rgba(255,255,255,.8); }
    .header-logo { height: 44px; width: auto; flex-shrink: 0; }
    .brand-group { display: flex; align-items: center; gap: .75rem; }
    .ext-link {
      color: rgba(255,255,255,.8); font-size: .85rem; padding: .35rem .7rem;
      border-radius: 4px; border: 1px solid rgba(255,255,255,.3);
    }
    .ext-link:hover { background: rgba(255,255,255,.15); text-decoration: none; }

    .hero { background: var(--contentBg); padding: 2rem 1.5rem; }
    .hero img { display: block; max-width: var(--max-w); width: 100%; height: auto; margin: 0 auto; border-radius: var(--radius); }

    main { max-width: var(--max-w); margin: 2.5rem auto; padding: 0 1.5rem; color: #fff; }

    .section-heading {
      font-size: 1.4rem; color: var(--accent); text-transform: uppercase;
      letter-spacing: .04em; border-bottom: 3px solid var(--accent); padding-bottom: .3rem; margin-bottom: 1.25rem;
      display: flex; align-items: center; gap: .5rem;
    }
    .section-heading .tri-accent {
      display: inline-flex; gap: 3px; flex-shrink: 0;
    }
    .section-heading .tri-accent img { height: 14px; width: auto; }

    .lodge-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1rem; margin-bottom: 2.5rem;
    }
    .lodge-card {
      background: var(--card-bg); border: 1px solid var(--border); border-top: 4px solid var(--secondary);
      border-radius: var(--radius); box-shadow: var(--shadow); padding: 1.25rem;
      display: flex; flex-direction: column; gap: .4rem;
      transition: box-shadow .15s, transform .15s;
    }
    .lodge-card:hover { box-shadow: 0 6px 20px rgba(0,0,0,.14); transform: translateY(-2px); text-decoration: none; }
    .lodge-num  { font-size: .7rem; font-weight: 700; text-transform: uppercase; letter-spacing: .08em; color: var(--neutral); }
    .lodge-name { font-size: 1.05rem; font-weight: 700; color: var(--primary); }
    .lodge-arrow { margin-top: .5rem; font-size: .82rem; color: var(--secondary); font-weight: 600; }

    .content-box {
      background: var(--contentBg); border: 1px solid var(--border); border-radius: var(--radius);
      padding: 1.75rem; box-shadow: var(--shadow); color: var(--text);
    }
    .content-box p { margin-bottom: .75rem; font-size: .95rem; }
    .content-box .section-heading { color: var(--primary); }
    .content-box + .content-box { margin-top: 2rem; }

    footer {
      background: var(--secondary); color: var(--accent); text-align: center;
      padding: 1.5rem; margin-top: 3rem; font-size: .85rem;
    }
    footer a { color: var(--accent); opacity: .85; }
    footer a:hover { opacity: 1; }

    @media (max-width: 640px) {
      .hero h1 { font-size: 1.7rem; }
      .lodge-grid { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <div class="tricolor">
    <span style={`background:${primary}`}></span>
    <span style={`background:${secondary}`}></span>
    <span style={`background:${accent}`}></span>
  </div>

  <header>
    <div class="header-inner">
      <a href="/" style="text-decoration:none" class="brand-group">
        <img src="/seal.svg" alt="KoP Seal" class="header-logo" />
        <div>
          <div class="brand-name">Oregon Knights of Pythias</div>
          <div class="brand-sub">Grand Domain of Oregon &middot; Lodge Directory</div>
        </div>
      </a>
      <a href="https://www.pythias.org" target="_blank" rel="noopener" class="ext-link">Supreme Lodge ↗</a>
    </div>
  </header>

  <div class="hero">
    <img src="/hero.png" alt="Oregon Knights of Pythias — Friendship, Charity, Benevolence" />
  </div>

  <main>
    <div class="content-box">
      <h2 class="section-heading">
        <span class="tri-accent"><img src="/bluetri.svg" alt="" /><img src="/redtri.svg" alt="" /><img src="/yeltri.svg" alt="" /></span>
        Oregon Lodges
      </h2>
      <p style="margin-bottom:1.25rem;font-size:.95rem;color:#555">
        Select a lodge below to visit their website, view events, meet their officers, and learn about their community service.
      </p>

      <div class="lodge-grid">
        {lodges.map((lodge) => (
          <a href={`/${lodge.slug}/`} class="lodge-card">
            <div class="lodge-num">Lodge No. {lodge.number}</div>
            <div class="lodge-name">{lodge.name.replace(` Lodge No. ${lodge.number}`, "").replace(` No. ${lodge.number}`, "")}</div>
            <div class="lodge-arrow">Visit site &rarr;</div>
          </a>
        ))}
      </div>
    </div>

    <div class="content-box">
      <h2 class="section-heading">
        <span class="tri-accent"><img src="/bluetri.svg" alt="" /><img src="/redtri.svg" alt="" /><img src="/yeltri.svg" alt="" /></span>
        About the Knights of Pythias
      </h2>
      <p>
        The Knights of Pythias is a non-sectarian fraternal organization founded in 1864 in Washington, D.C.
        by Justus H. Rathbone. It was the first fraternal organization to receive a charter from an Act of Congress.
      </p>
      <p>
        Oregon lodges are united by the ideals of <strong>Friendship, Charity, and Benevolence</strong>,
        serving their local communities while connected through the Grand Domain of Oregon.
      </p>
    </div>
  </main>

  <footer>
    <p>
      &copy; {new Date().getFullYear()} Grand Domain of Oregon &mdash; Knights of Pythias &middot;
      <a href="https://www.pythias.org" target="_blank" rel="noopener">pythias.org</a>
      <span style="margin-left:.5rem"><a href="/admin">Admin</a></span>
    </p>
  </footer>
</body>
</html>
