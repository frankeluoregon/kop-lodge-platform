---
import { getAllLodges } from "../lib/db";

const db = Astro.locals.runtime.env.DB;
const lodges = await getAllLodges(db);

const primary   = "#252e67";
const accent    = "#f5a71c";
const secondary = "#a91e23";
const neutral   = "#4a5072";
const contentBg = "#ded3c3";
---

<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oregon Knights of Pythias – Lodge Directory</title>
  <meta name="description" content="Oregon Knights of Pythias — Lodge Directory. Friendship, Charity, Benevolence." />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <style define:vars={{ primary, accent, secondary, neutral, contentBg }}>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --primary: var(--primary); --accent: var(--accent); --neutral: var(--neutral);
      --text: #1a1a2e; --bg: #f7f8fc; --card-bg: #fff;
      --border: #dde0eb; --radius: 6px; --shadow: 0 2px 8px rgba(0,0,0,.08);
      --max-w: 1100px; --font: 'Trebuchet MS', Trebuchet, 'Gill Sans MT', Arial, sans-serif;
    }
    body {
      font-family: var(--font); color: var(--text); line-height: 1.7;
      background-image: url('/mainbg.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-color: var(--primary);
    }
    a { color: var(--primary); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .tricolor { display: flex; height: 5px; border-top: 2px solid #000; border-bottom: 2px solid #000; }
    .tricolor span { flex: 1; }

    header { background: rgba(74,80,114,.92); padding: 0 1.5rem; }
    .header-inner {
      max-width: var(--max-w); margin: 0 auto;
      display: flex; align-items: center; justify-content: space-between; gap: 1rem; padding: .5rem 0;
    }
    .brand-name { font-size: .95rem; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: .04em; }
    .brand-sub  { font-size: .65rem; color: rgba(255,255,255,.8); }
    .header-logo { height: 22px; width: auto; flex-shrink: 0; }
    .brand-group { display: flex; align-items: center; gap: .5rem; }
    .ext-link {
      color: rgba(255,255,255,.8); font-size: .75rem; padding: .2rem .4rem;
      border-radius: 4px; border: 1px solid rgba(255,255,255,.3);
    }
    .ext-link:hover { background: rgba(255,255,255,.15); text-decoration: none; }

    .hero { text-align: center; }
    .hero img { display: block; max-width: var(--max-w); width: 100%; height: auto; margin: 0 auto; margin-bottom: -30px; clip-path: inset(0 0 30px 0); }

    main { max-width: 100%; margin: 0; padding: 0; color: #fff; }
    main .content-box { max-width: var(--max-w); margin: 0 auto; border-radius: 0; border-left: none; border-right: none; }

    .section-heading {
      font-size: 1.4rem; color: var(--accent); text-transform: uppercase;
      letter-spacing: .04em; border-bottom: 3px solid var(--accent); padding-bottom: .3rem; margin-bottom: 1.25rem;
      display: flex; align-items: center; gap: .5rem;
    }
    .section-heading .tri-accent {
      display: inline-flex; gap: 3px; flex-shrink: 0;
    }
    .section-heading .tri-accent img { height: 14px; width: auto; }

    .lodge-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1rem; margin-bottom: 2.5rem;
    }
    .lodge-card {
      background: #f7f0e7; border: 1px solid var(--border); border-top: 4px solid var(--secondary);
      border-radius: var(--radius); box-shadow: var(--shadow); padding: 1.25rem;
      display: flex; flex-direction: column; gap: .4rem;
      transition: box-shadow .15s, transform .15s;
    }
    .lodge-card:hover { box-shadow: 0 6px 20px rgba(0,0,0,.14); transform: translateY(-2px); text-decoration: none; }
    .lodge-num  { font-size: .7rem; font-weight: 700; text-transform: uppercase; letter-spacing: .08em; color: var(--neutral); }
    .lodge-name { font-size: 1.05rem; font-weight: 700; color: var(--primary); }
    .lodge-arrow { margin-top: .5rem; font-size: .82rem; color: var(--secondary); font-weight: 600; }

    .content-box {
      background: rgba(222,211,195,0.90); border: 1px solid var(--border); border-radius: var(--radius);
      padding: 1.75rem; box-shadow: var(--shadow); color: var(--text);
    }
    .content-box p { margin-bottom: .75rem; font-size: .95rem; }
    .content-box .section-heading { color: var(--primary); }
    .content-box + .content-box { border-top: 3px solid var(--primary); }

    footer {
      background: var(--secondary); color: var(--accent); text-align: center;
      padding: 1.5rem; margin-top: 3rem; font-size: .85rem;
    }
    footer a { color: var(--accent); opacity: .85; }
    footer a:hover { opacity: 1; }

    @media (max-width: 640px) {
      .hero h1 { font-size: 1.7rem; }
      .lodge-grid { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <div class="tricolor">
    <span style={`background:${primary}`}></span>
    <span style={`background:${secondary}`}></span>
    <span style={`background:${accent}`}></span>
  </div>

  <header>
    <div class="header-inner">
      <a href="/" style="text-decoration:none" class="brand-group">
        <img src="/seal.svg" alt="KoP Seal" class="header-logo" />
        <div>
          <div class="brand-name">Oregon Knights of Pythias</div>
          <div class="brand-sub">Grand Domain of Oregon &middot; Lodge Directory</div>
        </div>
      </a>
      <nav style="display:flex;gap:.4rem;align-items:center;flex-wrap:wrap">
        <a href="/grand-lodge/officers" class="ext-link">Grand Officers</a>
        <a href="/grand-lodge/history" class="ext-link">History</a>
        <a href="https://www.pythias.org" target="_blank" rel="noopener" class="ext-link">Supreme Lodge ↗</a>
      </nav>
    </div>
  </header>

  <div class="tricolor">
    <span style={`background:${primary}`}></span>
    <span style={`background:${secondary}`}></span>
    <span style={`background:${accent}`}></span>
  </div>

  <div class="hero">
    <img src="/hero.png" alt="Oregon Knights of Pythias — Friendship, Charity, Benevolence" />
  </div>

  <div class="tricolor">
    <span style={`background:${primary}`}></span>
    <span style={`background:${secondary}`}></span>
    <span style={`background:${accent}`}></span>
  </div>

  <main>
    <div class="content-box">
      <h2 class="section-heading">
        <span class="tri-accent"><img src="/bluetri.svg" alt="" /><img src="/redtri.svg" alt="" /><img src="/yeltri.svg" alt="" /></span>
        Oregon Lodges
      </h2>
      <p style="margin-bottom:1.25rem;font-size:.95rem;color:#555">
        Select a lodge below to visit their website, view events, meet their officers, and learn about their community service.
      </p>

      <div class="lodge-grid">
        {lodges.map((lodge) => (
          <a href={`/lodges/${lodge.slug}/`} class="lodge-card">
            <div class="lodge-num">Lodge No. {lodge.number}</div>
            <div class="lodge-name">{lodge.name.replace(` Lodge No. ${lodge.number}`, "").replace(` No. ${lodge.number}`, "")}</div>
            <div class="lodge-arrow">Visit site &rarr;</div>
          </a>
        ))}
      </div>
    </div>

    <div class="content-box">
      <h2 class="section-heading">
        <span class="tri-accent"><img src="/bluetri.svg" alt="" /><img src="/redtri.svg" alt="" /><img src="/yeltri.svg" alt="" /></span>
        About the Knights of Pythias
      </h2>
      <p>
        The Order Knights of Pythias is a chivalric order and fraternal organization dedicated to inspiring those
        knightly virtues which elevate mankind and manifest <strong>Friendship, Charity, and Benevolence</strong>.
        Our Order derives its name from the historical account of Damon and Pythias, two friends who mutually
        pledged their lives to each other and famously held fast to their word of honor, even to the point of death.
        Knights of Pythias the world over are inducted, initiated, and congregated in local lodges which are
        subordinate to the Grand Lodge of their state or domain, and all are under the authority of the Supreme Lodge.
      </p>
      <p>
        Candidates for initiation into the Order are carefully chosen and artfully initiated in secret rituals,
        wherein the carefully guarded inheritance and legacy of brotherhood and life-long friendship is shared just
        as it has been since its inception. The ritual work of our Order continues to impress and instruct all who
        witness its discipline. We thereby cultivate and foster the same chivalric principles that have enlightened
        those in our ranks for over 150 years. In traditions that trace their origins to Ancient and Classical Greece,
        to Pythagoras and his fabled Pythagorean Society, through Medieval Europe's knightly past, and finally
        arriving at our own Order, the highest thoughts of the greatest minds and hearts find safe repose and bright
        revival within the portals of our Castle Halls.
      </p>
    </div>
  </main>

  <footer>
    <p>
      &copy; {new Date().getFullYear()} Grand Domain of Oregon &mdash; Knights of Pythias &middot;
      <a href="https://www.pythias.org" target="_blank" rel="noopener">pythias.org</a>
      <span style="margin-left:.5rem"><a href="/admin">Admin</a></span>
    </p>
  </footer>
</body>
</html>
